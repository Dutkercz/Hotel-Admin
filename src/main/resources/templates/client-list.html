<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <title>Lista de Clientes</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center p-6">

<div class="bg-white shadow-2xl rounded-3xl p-8 w-full max-w-7xl my-12">

    <div th:if="${success}" class="bg-emerald-100 text-emerald-700 p-3 rounded-lg mb-4 text-center font-semibold">
        <p th:text="${success}"></p>
    </div>

    <h1 class="text-4xl font-extrabold text-slate-800 text-center mb-8">Clientes Cadastrados</h1>

    <div class="overflow-x-auto rounded-2xl shadow-lg border border-slate-200 mb-6">
        <table class="w-full text-left bg-white">
            <thead class="bg-sky-600 text-white">
            <tr>
                <th class="py-4 px-6 font-bold">ID</th>
                <th class="py-4 px-6 font-bold">Nome</th>
                <th class="py-4 px-6 font-bold">CPF</th>
                <th class="py-4 px-6 font-bold">Telefone</th>
                <th class="py-4 px-6 font-bold text-center">Status</th>
                <th class="py-4 px-6 font-bold text-center">Opções</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-slate-200 text-slate-700">
            <tr th:each="c : ${clients}" class="hover:bg-sky-50 transition-colors"
                th:with="clientStatus=${c.status}">
                <td class="py-3 px-6" th:text="${c.id}"></td>
                <td class="py-3 px-6" th:text="${c.firstName + ' ' + c.lastName}"></td>
                <td class="py-3 px-6" th:text="${c.cpf}"></td>
                <td class="py-3 px-6" th:text="${c.phone}"></td>
                <td class="py-3 px-6 text-center font-bold"
                    th:text="${c.status.name() == 'ACTIVE' ? 'ATIVO' : c.status.name() == 'INACTIVE' ? 'INATIVO' : 'BANIDO'}"
                    th:class="${c.status.name() == 'ACTIVE' ? 'text-emerald-600' :
                               c.status.name() == 'INACTIVE' ? 'text-red-600' : 'text-slate-500'}">
                </td>
                <td class="py-3 px-6 flex flex-col sm:flex-row gap-2 items-center justify-center">
                    <button type="button" th:onclick="'window.location.href=\'' + @{/clients/update/{id}(id=${c.id})} + '\';'"
                            class="bg-sky-600 text-white px-4 py-2 rounded-xl shadow-md hover:bg-sky-700 transition-all font-semibold w-full sm:w-auto">
                        Atualizar
                    </button>
                    <button type="button" th:onclick="'confirmDelete(' + ${c.id} + ');'"
                            class="bg-red-600 text-white px-4 py-2 rounded-xl shadow-md hover:bg-red-700 transition-all font-semibold w-full sm:w-auto">
                        Deletar
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-6">
        <div class="flex items-center gap-4">
            <a th:if="${clients.hasPrevious()}" th:href="@{/clients/list(page=${clients.number - 1}, size=${clients.size})}"
               class="bg-sky-600 text-white px-4 py-2 rounded-lg shadow hover:bg-sky-700 transition">Anterior</a>
            <span>Página <span th:text="${clients.number + 1}"></span> de <span th:text="${clients.totalPages}"></span></span>
            <a th:if="${clients.hasNext()}" th:href="@{/clients/list(page=${clients.number + 1}, size=${clients.size})}"
               class="bg-sky-600 text-white px-4 py-2 rounded-lg shadow hover:bg-sky-700 transition">Próxima</a>
        </div>

        <div class="flex items-center gap-4">
            <a th:href="@{/clients/new}"
               class="bg-sky-600 text-white px-6 py-2 rounded-xl shadow-md hover:bg-sky-700 transition font-semibold">
                + Novo Cliente
            </a>
            <a th:href="@{/}"
               class="bg-slate-700 text-white px-6 py-2 rounded-xl shadow-md hover:bg-slate-800 transition font-semibold">
                Página Inicial
            </a>
        </div>

        <form th:action="@{/clients/detail}" method="get" class="flex items-center gap-2">
            <label for="cpf" class="sr-only">CPF</label>
            <input id="cpf" name="cpf" type="text" placeholder="Pesquisar por CPF"
                   class="border border-slate-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500 text-slate-800">
            <button type="submit"
                    class="bg-sky-600 text-white px-4 py-2 rounded-lg shadow hover:bg-sky-700 transition">
                Buscar
            </button>
        </form>
    </div>
</div>

<script>
    function confirmDelete(id) {
        if (confirm("Tem certeza que deseja deletar este cliente?")) {
            fetch(`/clients/delete/${id}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    alert("Cliente deletado com sucesso!");
                    location.reload();
                } else {
                    alert("Ocorreu um erro ao deletar o cliente.");
                }
            })
            .catch(error => {
                console.error(error);
                alert("Ocorreu um erro ao deletar o cliente.");
            });
        }
    }
</script>

</body>
</html>
